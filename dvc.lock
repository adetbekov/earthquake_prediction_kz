schema: '2.0'
stages:
  collect_data:
    cmd: python src/collect_data.py
    deps:
    - path: src/collect_data.py
      md5: 629f714d2909cdc874f5f8c923fda1b5
      size: 1065
    params:
      params.yaml:
        collect_data:
          endtime: '2022-09-01'
          maxlatitude: 55.588
          minlatitude: 40.459
          maxlongitude: 87.012
          minlongitude: 46.055
          minmagnitude: 0
    outs:
    - path: data/data.json
      md5: 9a0ae139659dacd4311893adadadb189
      size: 3958869
  preprocess@zero:
    cmd: python src/preprocess.py zero
    deps:
    - path: data/data.json
      md5: 69bf3147b15011cc3dc05fc062dd481d
      size: 3667841
    - path: data/geocoded_areas.csv
      md5: d3f1fce283b88b6438b50f3dec561a9e
      size: 14726
    - path: src/preprocess.py
      md5: cf0d370caea2fdf810dd9cc7862d91f9
      size: 6728
    params:
      params.yaml:
        preprocess:
          na_strategies:
          - zero
          roll_years_agg:
          - 3
          - 10
          - 25
          - 50
          - 80
          - 100
        target:
          mag_max_target_th: 5
    outs:
    - path: artifacts/zero/data.csv
      md5: b87f983a5bdc988d2b90b767da72d3e7
      size: 1621163
    - path: artifacts/zero/metadata.json
      md5: 6210fde1a7cdfe2b9030802c0395fe7a
      size: 1460
  preprocess@min:
    cmd: python src/preprocess.py min
    deps:
    - path: data/data.json
      md5: 933ff289897b0cd6ea27a67c96b8582a
      size: 3957486
    - path: data/geocoded_areas.csv
      md5: d3f1fce283b88b6438b50f3dec561a9e
      size: 14726
    - path: src/preprocess.py
      md5: 6ba899205918764f76928b8166a32cd9
      size: 6728
    params:
      params.yaml:
        preprocess:
          na_strategies:
          - zero
          - min
          - mean
          roll_years_agg:
          - 3
          - 10
          - 25
          - 50
          - 80
          - 100
        target:
          mag_max_target_th: 5
    outs:
    - path: artifacts/min/data.csv
      md5: f81292d4c707097901437ebca60f2d8f
      size: 1662427
    - path: artifacts/min/metadata.json
      md5: 9e7cf0c5f2d4f4834f058176991a9a03
      size: 1458
  preprocess@mean:
    cmd: python src/preprocess.py mean
    deps:
    - path: data/data.json
      md5: 933ff289897b0cd6ea27a67c96b8582a
      size: 3957486
    - path: data/geocoded_areas.csv
      md5: d3f1fce283b88b6438b50f3dec561a9e
      size: 14726
    - path: src/preprocess.py
      md5: 6ba899205918764f76928b8166a32cd9
      size: 6728
    params:
      params.yaml:
        preprocess:
          na_strategies:
          - zero
          - min
          - mean
          roll_years_agg:
          - 3
          - 10
          - 25
          - 50
          - 80
          - 100
        target:
          mag_max_target_th: 5
    outs:
    - path: artifacts/mean/data.csv
      md5: 7393b49d019e455a53557a4360afcce7
      size: 3641022
    - path: artifacts/mean/metadata.json
      md5: b06ee7f3581a923dff342863e5401ae6
      size: 1459
  train_test_split@zero:
    cmd: python src/train_test_split.py zero
    deps:
    - path: artifacts/zero/data.csv
      md5: b87f983a5bdc988d2b90b767da72d3e7
      size: 1621163
    - path: src/train_test_split.py
      md5: 5c53e8954fb2d69654a69d297f2c0a9b
      size: 1532
    params:
      params.yaml:
        seed: 42
        train_test_split:
          test_size: 0.2
          dropzero_train: false
          dropzero_test: false
    outs:
    - path: artifacts/zero/test.csv
      md5: 3d6cd5fca874f51208031847fbcbe260
      size: 395350
    - path: artifacts/zero/train.csv
      md5: b8a5d8f0c2ef5486f91c6d783f83ae3b
      size: 1562700
  train_test_split@min:
    cmd: python src/train_test_split.py min
    deps:
    - path: artifacts/min/data.csv
      md5: f81292d4c707097901437ebca60f2d8f
      size: 1662427
    - path: src/train_test_split.py
      md5: 5c53e8954fb2d69654a69d297f2c0a9b
      size: 1532
    params:
      params.yaml:
        seed: 42
        train_test_split:
          test_size: 0.2
          dropzero_train: true
          dropzero_test: true
    outs:
    - path: artifacts/min/test.csv
      md5: a9c5b45fc93136b983e145728c2f9470
      size: 183393
    - path: artifacts/min/train.csv
      md5: 7fae78382a6287648b7d36074fbfac88
      size: 714826
  train_test_split@mean:
    cmd: python src/train_test_split.py mean
    deps:
    - path: artifacts/mean/data.csv
      md5: 7393b49d019e455a53557a4360afcce7
      size: 3641022
    - path: src/train_test_split.py
      md5: 5c53e8954fb2d69654a69d297f2c0a9b
      size: 1532
    params:
      params.yaml:
        seed: 42
        train_test_split:
          test_size: 0.2
          dropzero_train: true
          dropzero_test: true
    outs:
    - path: artifacts/mean/test.csv
      md5: 36ab18a994629356d231a06e6f1da157
      size: 802268
    - path: artifacts/mean/train.csv
      md5: 35793523b4ff415b020453ddd8b1ecf0
      size: 3184404
  model@random_forest@mean:
    cmd: python src/model_random_forest.py mean
    deps:
    - path: artifacts/mean/test.csv
      md5: 36ab18a994629356d231a06e6f1da157
      size: 802268
    - path: artifacts/mean/train.csv
      md5: 35793523b4ff415b020453ddd8b1ecf0
      size: 3184404
    - path: src/evaluation.py
      md5: 4a7934d3317e43d6e42d0768195b4707
      size: 2493
    - path: src/model_random_forest.py
      md5: f9a4c084b1248798fa96bc4a9fe989e1
      size: 1930
    params:
      params.yaml:
        random_forest:
          params:
            n_estimators: 500
            max_depth: 10
        seed: 42
    outs:
    - path: artifacts/mean/clf_rf.pkl
      md5: 9880497aaa2b0f0da97df44a1151186d
      size: 3371337
    - path: artifacts/mean/rf_features.pkl
      md5: 29e1abc4fcdcfb321fd116f8ad4896bc
      size: 7482
    - path: artifacts/mean/rf_mean_test_plots/distribution.png
      md5: 590e887aa349871801ce65c677d9600b
      size: 38144
    - path: artifacts/mean/rf_mean_test_plots/roc_auc.png
      md5: d27b7b6052e34f9765cce649e6b8911c
      size: 102543
    - path: artifacts/mean/rf_mean_train_plots/distribution.png
      md5: e67062fec245ba157856e42c8948c293
      size: 40397
    - path: artifacts/mean/rf_mean_train_plots/roc_auc.png
      md5: 4aace5c564f167db32d826886eea0c9f
      size: 100273
    - path: artifacts/mean/test_metrics.json
      md5: d300593e25d838ecf090fcc00fe21187
      size: 232
    - path: artifacts/mean/train_metrics.json
      md5: bf130a2e30a693f7a1e312c8da326329
      size: 160
  model@random_forest@zero:
    cmd: python src/model_random_forest.py zero
    deps:
    - path: artifacts/zero/test.csv
      md5: 3d6cd5fca874f51208031847fbcbe260
      size: 395350
    - path: artifacts/zero/train.csv
      md5: b8a5d8f0c2ef5486f91c6d783f83ae3b
      size: 1562700
    - path: src/evaluation.py
      md5: 4a7934d3317e43d6e42d0768195b4707
      size: 2493
    - path: src/model_random_forest.py
      md5: ebbd67662cb2fa2314b55bcce6f66cff
      size: 3299
    params:
      params.yaml:
        random_forest:
          params:
            n_estimators: 500
            max_depth: 10
        seed: 42
    outs:
    - path: artifacts/zero/clf_rf.pkl
      md5: 1b48a24ec1408d717432b344a3ccb5d8
      size: 5158390
    - path: artifacts/zero/rf_features.pkl
      md5: 8f413fe53584706eebbb48ef99261c26
      size: 7414
    - path: artifacts/zero/rf_metrics.json
      md5: d3046d0de802ada4df3785381f4e4984
      size: 235
  model@random_forest@min:
    cmd: python src/model_random_forest.py min
    deps:
    - path: artifacts/min/test.csv
      md5: a9c5b45fc93136b983e145728c2f9470
      size: 183393
    - path: artifacts/min/train.csv
      md5: 7fae78382a6287648b7d36074fbfac88
      size: 714826
    - path: src/evaluation.py
      md5: 4a7934d3317e43d6e42d0768195b4707
      size: 2493
    - path: src/model_random_forest.py
      md5: f9a4c084b1248798fa96bc4a9fe989e1
      size: 1930
    params:
      params.yaml:
        random_forest:
          params:
            n_estimators: 500
            max_depth: 10
        seed: 42
    outs:
    - path: artifacts/min/clf_rf.pkl
      md5: 186352f02b7c545a75c41dcc6c05ef17
      size: 2486340
    - path: artifacts/min/rf_features.pkl
      md5: 29e1abc4fcdcfb321fd116f8ad4896bc
      size: 7482
    - path: artifacts/min/rf_min_test_plots/distribution.png
      md5: c0b13a077332939715e1437cbd07c7d2
      size: 37096
    - path: artifacts/min/rf_min_test_plots/roc_auc.png
      md5: cdbf5e89246636fb7313b6fc7123c490
      size: 101296
    - path: artifacts/min/rf_min_train_plots/distribution.png
      md5: 10b49eb0e4b1922b1cd8e493a7eb8773
      size: 34904
    - path: artifacts/min/rf_min_train_plots/roc_auc.png
      md5: 4aace5c564f167db32d826886eea0c9f
      size: 100273
    - path: artifacts/min/test_metrics.json
      md5: a9838e2b705da8fc1d97121623a227b8
      size: 232
    - path: artifacts/min/train_metrics.json
      md5: 990438dd040ee494f1f9e8afd130a64d
      size: 158
  preprocess:
    cmd: python src/preprocess.py
    deps:
    - path: data/data.json
      md5: 9a0ae139659dacd4311893adadadb189
      size: 3958869
    - path: data/geocoded_areas.csv
      md5: d3f1fce283b88b6438b50f3dec561a9e
      size: 14726
    - path: src/preprocess.py
      md5: fa515911505355526d92918bda847092
      size: 6622
    params:
      params.yaml:
        preprocess:
          na_strategy: zero
          roll_years_agg:
          - 3
          - 10
          - 25
          - 50
          - 80
          - 100
        target:
          mag_max_target_th: 5
    outs:
    - path: artifacts/data.csv
      md5: 01f45301e33f5d2c0c4b02ff765a3c6b
      size: 1901923
    - path: artifacts/metadata.json
      md5: 912a8922db350e40863cd349d7ce14d9
      size: 1458
  train_test_split:
    cmd: python src/train_test_split.py
    deps:
    - path: artifacts/data.csv
      md5: 01f45301e33f5d2c0c4b02ff765a3c6b
      size: 1901923
    - path: src/train_test_split.py
      md5: a86ad1a36aac648d6efd6dd0580a6a80
      size: 1247
    params:
      params.yaml:
        seed: 42
        train_test_split:
          test_size: 0.2
          dropzero_train: false
          dropzero_test: true
    outs:
    - path: artifacts/test.csv
      md5: d76d7f00ffc6e36fcdbf369f71195fac
      size: 205024
    - path: artifacts/train.csv
      md5: 717044ff86abb3b4e0e0ef06440aebc5
      size: 1788837
  model@random_forest:
    cmd: python src/model_random_forest.py
    deps:
    - path: artifacts/test.csv
      md5: 41255038262cf22c197aef4763924098
      size: 398568
    - path: artifacts/train.csv
      md5: df804d3aaf694d2009b21771531de9f0
      size: 701840
    - path: src/evaluation.py
      md5: 1ae1eac3eb5d7516b23efcd99cee62d4
      size: 1754
    - path: src/model_random_forest.py
      md5: bcebd83cc2bedafb65a98cfdfb167caa
      size: 2272
    params:
      params.yaml:
        random_forest:
          params:
            n_estimators: 500
            max_depth: 10
        seed: 42
    outs:
    - path: eval_plots/plots/roc.json
      md5: 6a6a14605b4d8106ef7196f8276a7597
      size: 7362
    - path: models/features_random_forest.pkl
      md5: 8f413fe53584706eebbb48ef99261c26
      size: 7414
    - path: models/fi_random_forest.png
      md5: c7b9d3b2a253bbb1cd025198676b8230
      size: 441581
    - path: models/metrics_random_forest.json
      md5: d882b3e013031dc07cf6a97c1ec1323e
      size: 230
    - path: models/model_random_forest.pkl
      md5: b6ac500b269b361be177099e105ea2bd
      size: 2960968
    - path: models/scordistr_random_forest.png
      md5: 056d4adc635c4f0fccc4a888d155c13c
      size: 30956
  model:
    cmd: python src/model.py
    deps:
    - path: artifacts/test.csv
      md5: d76d7f00ffc6e36fcdbf369f71195fac
      size: 205024
    - path: artifacts/train.csv
      md5: 717044ff86abb3b4e0e0ef06440aebc5
      size: 1788837
    - path: src/evaluation.py
      md5: c08bcc9dddbc59043deb379838f0b6bc
      size: 1757
    - path: src/model.py
      md5: 84725de7b771321288a1211564584df5
      size: 2660
    params:
      params.yaml:
        lightgbm:
          params:
            n_estimators: 500
            max_depth: -1
        model_type: lightgbm
        random_forest:
          params:
            n_estimators: 500
            max_depth: 10
        seed: 42
    outs:
    - path: eval_plots/plots/roc.json
      md5: 392eedd1a170117ff3c4c2dfd52d554a
      size: 5325
    - path: models/feature_importance.png
      md5: 86c265caa7c8579bfb010ec32b57b4ca
      size: 362393
    - path: models/features.pkl
      md5: 5d8e76df9aa647f8160c3d17fdfc38ed
      size: 8290
    - path: models/metrics.json
      md5: e4166b8ea5fa252ab62decd9f0b401f4
      size: 208
    - path: models/model.pkl
      md5: c1155001ec94b93151d9da678452f058
      size: 1141593
    - path: models/score_distribution.png
      md5: 440da5e92dff478a3c25b390b76a6664
      size: 34108
